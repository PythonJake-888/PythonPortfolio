{% extends "base.html" %}
{% block content %}

<h1>Admin Dashboard</h1>

<h2>Add Project</h2>
<form method="POST" action="{{ url_for('add_project') }}" class="admin-form">
  <input name="title" placeholder="Title" required>
  <textarea name="description" placeholder="Description"></textarea>
  <input name="tech" placeholder="Tech stack">
  <input name="github" placeholder="GitHub URL">
  <input name="demo_url" placeholder="Live demo URL">
  <label><input type="checkbox" name="has_demo"> Has Live Demo</label>
  <button class="btn">Create Project</button>
</form>

<hr>

<h2>Projects</h2>
<div class="admin-project-grid">
{% for project in projects %}
  <div class="admin-project-card">

    <h3>{{ project.title }}</h3>
    <p>{{ project.description }}</p>

    <form action="{{ url_for('upload_project_media', project_id=project.id) }}"
          method="POST" enctype="multipart/form-data">
      <input type="file" name="file" required>
        <a href="{{ url_for('edit_project', id=project.id) }}" class="btn">Edit</a>

      <button class="btn">Upload Media</button>
    </form>

    <div class="gallery">
  {% for media in project.media %}
    {% if media.media_type == "video" %}
      <video
        src="{{ media.url }}"
        class="project-media"
        controls>
      </video>
    {% else %}
      <img
        src="{{ media.url | replace('/upload/', '/upload/w_900,c_limit,q_auto,f_auto/') }}"
        class="project-media">
    {% endif %}
  {% endfor %}
</div>

      <div class="gallery media-strip">
{% for media in project.media %}
  <div class="media-tile">
    {% if media.media_type == "video" %}
      <video src="{{ media.url }}" class="media-item" muted></video>
    {% else %}
      <img src="{{ media.url }}" class="media-item">
    {% endif %}

    <form method="POST" action="{{ url_for('delete_project_media', id=media.id) }}">
      <button class="btn btn-delete btn-sm">Delete</button>
    </form>
  </div>
{% endfor %}
</div>



    <form method="POST" action="{{ url_for('delete_project', id=project.id) }}">


      <button class="btn btn-delete">Delete Project</button>
    </form>
  </div>
{% endfor %}
</div>

<hr>

<h2>Add Blog Post</h2>
<form method="POST" action="{{ url_for('add_blog') }}" class="admin-form">
  <input name="title" placeholder="Post title" required>
  <textarea name="body" placeholder="Post content" rows="6"></textarea>
  <button class="btn">Publish</button>
</form>

<h2>Blog Posts</h2>
{% for post in posts %}
  <div class="admin-blog-row">
    <span>{{ post.title }}</span>

    <div style="display:flex; gap:12px;">
      <a href="{{ url_for('edit_blog', id=post.id) }}" class="btn">Edit</a>

      <form method="POST" action="{{ url_for('delete_blog', id=post.id) }}">
        <button class="btn btn-delete">Delete</button>
      </form>
    </div>
  </div>
{% endfor %}


{% endblock %}
